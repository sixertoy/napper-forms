"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react")),PropTypes=_interopDefault(require("prop-types")),napperCore=require("@iziges/napper-core"),reactFinalForm=require("react-final-form"),draftJs=require("draft-js"),draftJsExportMarkdown=require("draft-js-export-markdown"),draftJsImportMarkdown=require("draft-js-import-markdown"),reactDraftWysiwyg=require("react-draft-wysiwyg"),onErrorFocusDecorator=_interopDefault(require("final-form-focus"));function parseErrors(e){return Array.isArray(e)?e:"string"==typeof e?[e]:e}const FieldError=({error:e,initial:r,pristine:t,submitError:a,touched:o})=>{const n=(o||r&&t)&&(e||a),s=parseErrors(e||a);return React.createElement("span",{className:"smarter-form-error"},n&&s.map((e,r)=>React.createElement("span",{className:"is-block",key:napperCore.uniqKeyId("error",r)},e)))};FieldError.defaultProps={error:null,initial:void 0,pristine:!1,submitError:null,touched:!1},FieldError.propTypes={error:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),initial:PropTypes.any,pristine:PropTypes.bool,submitError:PropTypes.oneOfType([PropTypes.string,PropTypes.arrayOf(PropTypes.string)]),touched:PropTypes.bool};const FieldLabel=({disabled:e,label:r,required:t})=>{let a="smarter-form-label";const o=Boolean(t);return e&&(a=`${a} disabled`),React.createElement("span",{className:a},React.createElement("span",null,r),o&&React.createElement("span",{className:"smarter-form-required-icon"},"*"))};FieldLabel.defaultProps={disabled:!1},FieldLabel.propTypes={disabled:PropTypes.bool,label:PropTypes.string.isRequired,required:PropTypes.oneOfType([PropTypes.bool,PropTypes.func,PropTypes.arrayOf(PropTypes.func)]).isRequired};class FormControls extends React.PureComponent{render(){const{buttons:e,canReset:r,canSubmit:t,disabled:a,onReset:o}=this.props,n=e.submit,s=e.cancel&&o;return React.createElement("div",null,s&&React.createElement("button",{type:"button",onClick:o,disabled:a||!r},e.cancel),n&&React.createElement("button",{type:"submit",disabled:a||!t},e.submit))}}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}FormControls.defaultProps={buttons:{cancel:"Annuler",submit:"Envoyer"},canReset:!1,canSubmit:!1,disabled:!1,onReset:()=>{}},FormControls.propTypes={buttons:PropTypes.shape({cancel:PropTypes.string,submit:PropTypes.string}),canReset:PropTypes.bool,canSubmit:PropTypes.bool,disabled:PropTypes.bool,onReset:PropTypes.func};class BooleanInput extends React.PureComponent{render(){const{className:e,disabled:r,label:t,labels:a,name:o,required:n}=this.props;return React.createElement(reactFinalForm.Field,{name:o,type:"hidden",parse:e=>"yes"===e,format:e=>!0===e?"yes":null},({input:s})=>React.createElement("div",{className:e},React.createElement(FieldLabel,{disabled:r,label:t,required:n}),React.createElement("div",null,React.createElement("input",_extends({},s,{type:"hidden"})),React.createElement("label",{htmlFor:`${o}::radio::yes`},React.createElement("input",{value:"yes",type:"radio",checked:s.value,name:`${o}::radio`,onChange:s.onChange,id:`${o}::radio::yes`}),React.createElement("span",null,a[0])),React.createElement("label",{htmlFor:`${o}::radio::no`},React.createElement("input",{value:"no",type:"radio",checked:!s.value,name:`${o}::radio`,onChange:s.onChange,id:`${o}::radio::no`}),React.createElement("span",null,a[1])))))}}BooleanInput.defaultProps={className:"m12",disabled:!1,labels:["Oui","Non"],required:!1},BooleanInput.propTypes={className:PropTypes.string,disabled:PropTypes.bool,label:PropTypes.string.isRequired,labels:PropTypes.arrayOf(PropTypes.string),name:PropTypes.string.isRequired,required:PropTypes.bool};const noop=()=>({}),composedValidate=e=>r=>{return e.reduce((e,t)=>{return{...e,...t(r)}},{})},composeFormValidator=e=>{if(!e||!Array.isArray(e))return noop;const r=e.map(e=>{const r="function"==typeof e;return r||console.warn("Validator is not a function: ",typeof e),r?e:noop});return composedValidate(r)},noopnoop=()=>void 0,compose=(...e)=>r=>e.reduce((e,t)=>{return[...e,t(r)]},[]),isBoolean=e=>"boolean"==typeof e,isFunction=e=>"function"==typeof e,isTrue=e=>isBoolean(e)&&!0===e,isFalse=e=>isBoolean(e)&&!1===e,isValidArray=e=>{if(!Array.isArray(e))return!1;return e.filter(isFunction).length>0},isValid=e=>isBoolean(e)||isFunction(e)||isValidArray(e),parseValidatorsArguments=e=>e.reduce((e,r)=>!e.length&&isValid(r)?[r]:isValid(r)&&!isBoolean(r)?[...e,r]:e,[]),toArray=e=>{if(isFunction(e))return[e];const r=e.filter(isFunction);return r.length?r:[noopnoop]},parseValidators=(...e)=>{const r=parseValidatorsArguments(e);if(!r.length)return toArray(noopnoop);const[t,a]=r;if(!isValid(t)||isFalse(t)||isBoolean(t)&&!isValid(a)||isBoolean(t)&&isBoolean(a))return toArray(noopnoop);if(isTrue(t)&&isValid(a))return toArray(a);const o=isFunction(t)||isValidArray(t);return toArray(o?t:noopnoop)},composeValidators=(e,r)=>{const t=parseValidators(e,r);return compose(...t)},ERROR_MSG="Field is out of range",includesRange=(e,r)=>t=>{if(t<e||t>r)return ERROR_MSG},ERROR_MSG$1="Field must be filled",isNotEmptyString=e=>{let r=e&&"string"==typeof e&&e.trim()||"";if(!((r=(r=r.replace(/&nbsp;/g," ")).replace(/\s+/g,""))&&r.length&&""!==r))return ERROR_MSG$1},ERROR_MSG$2="Value is not a number",isNumber=e=>{const r="number"==typeof e&&!Number.isNaN(e),t="string"==typeof e&&RegExp(/^((-{0,1})([0-9]*)(\.{0,1}|,{0,1})([0-9]+)|(-{0,1}Infinity))$/gm).test(e);if(!(r||t))return ERROR_MSG$2},isRequired=e=>null!==e&&"null"!==e&&"undefined"!==e&&void 0!==e,DEFAULT_VALIDATORS=[isNumber];class NumberInput extends React.PureComponent{render(){const{className:e,disabled:r,label:t,max:a,min:o,name:n,placeholder:s,required:i,step:l}=this.props,p=[...DEFAULT_VALIDATORS,includesRange(o,a)],d=composeValidators(i,p);return React.createElement(reactFinalForm.Field,{name:n,validate:d},({input:p,meta:d})=>React.createElement("div",{className:e},React.createElement("label",{htmlFor:n},React.createElement(FieldLabel,{label:t,disabled:r,required:i}),React.createElement("input",_extends({},p,{type:"number",max:a,min:o,step:l,disabled:r,placeholder:s})),React.createElement(FieldError,d))))}}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}NumberInput.defaultProps={className:"m12",disabled:!1,max:1/0,min:-1/0,placeholder:"Enter a value",required:!1,step:1,toot:!0},NumberInput.propTypes={className:PropTypes.string,disabled:PropTypes.bool,label:PropTypes.string.isRequired,max:PropTypes.number,min:PropTypes.number,name:PropTypes.string.isRequired,placeholder:PropTypes.string,required:PropTypes.oneOfType([PropTypes.bool,PropTypes.func,PropTypes.arrayOf(PropTypes.func)]),step:PropTypes.number,toot:PropTypes.bool};const MARKDOWN_DEBOUNCE_MS=500,MARKDOWN_VIEWS=["markdown","raw"],MARKDOWN_EDITOR_VIEWS=napperCore.mirrorKeys(MARKDOWN_VIEWS,[napperCore.ucfirst]),MARKDOWN_EDITOR_TOOLBAR={blockType:{options:["Normal","H1","H2","H3","H4","H5","H6"]},inline:{options:["bold","italic","underline","strikethrough"]},options:["inline","blockType"]},parseMarkdown=e=>{const r=draftJsImportMarkdown.stateFromMarkdown(e);return draftJs.EditorState.createWithContent(r)},stringifyMarkdown=e=>{const r=e.getCurrentContent();return draftJsExportMarkdown.stateToMarkdown(r)};class RichTextEditorHeader extends React.PureComponent{render(){const{activeView:e,clickHandler:r,labels:t}=this.props,a=["markdown","editor","controls"];return React.createElement("div",{className:""},Object.keys(MARKDOWN_EDITOR_VIEWS).map((o,n)=>{const s=o,i=e===s,l=napperCore.uniqKeyId(a,s),p=t&&t[n]||MARKDOWN_EDITOR_VIEWS[o];return React.createElement("button",{key:l,type:"button",onClick:()=>r(s),disabled:i},React.createElement("span",null,p))}))}}RichTextEditorHeader.defaultProps={labels:null},RichTextEditorHeader.propTypes={activeView:PropTypes.string.isRequired,clickHandler:PropTypes.func.isRequired,labels:PropTypes.arrayOf(PropTypes.string)};class RichTextEditorMarkdown extends React.PureComponent{constructor(e){super(e),_defineProperty(this,"updateInputAfterStateChanges",napperCore.debounce(()=>{const{editorState:e}=this.state,{onChangeHandler:r}=this.props;r(stringifyMarkdown(e))},MARKDOWN_DEBOUNCE_MS)),_defineProperty(this,"onEditorStateChange",e=>{this.setState({editorState:e},this.updateInputAfterStateChanges)});const{content:r}=e,t=parseMarkdown(r||"");this.state={editorState:t}}render(){const{editorState:e}=this.state,{readonly:r,visible:t}=this.props,a=t?"is-block":"is-hidden";return React.createElement("div",{className:a},React.createElement(reactDraftWysiwyg.Editor,{readOnly:r,initialEditorState:e,toolbar:MARKDOWN_EDITOR_TOOLBAR,editorClassName:"markdown-draft-editor",wrapperClassName:"markdown-draft-wrapper",toolbarClassName:"markdown-draft-toolbar",onEditorStateChange:this.onEditorStateChange}))}}RichTextEditorMarkdown.defaultProps={content:"",readonly:!1,visible:!0},RichTextEditorMarkdown.propTypes={content:PropTypes.string,onChangeHandler:PropTypes.func.isRequired,readonly:PropTypes.bool,visible:PropTypes.bool};const MarkdownEditorRaw=({input:e,readonly:r,visible:t})=>{const a=t?"is-block":"is-hidden";return React.createElement("div",{className:a},React.createElement("textarea",_extends({},e,{readOnly:r,style:{height:"180px",resize:"none",width:"100%"}})))};MarkdownEditorRaw.defaultProps={readonly:!0,visible:!1},MarkdownEditorRaw.propTypes={input:PropTypes.shape().isRequired,readonly:PropTypes.bool,visible:PropTypes.bool};class RichTextInput extends React.PureComponent{constructor(e){super(e),_defineProperty(this,"onToggleViewHandler",e=>{this.setState({activeView:e})}),this.state={activeView:MARKDOWN_VIEWS[0]}}render(){const{activeView:e}=this.state,{className:r,label:t,name:a,required:o}=this.props;return React.createElement(reactFinalForm.Field,{name:a,label:t},({input:n})=>React.createElement("div",{className:r},React.createElement("label",{htmlFor:a},React.createElement(FieldLabel,{label:t,required:o}),React.createElement("div",{className:"markdown-editor-container"},React.createElement(RichTextEditorHeader,{activeView:e,clickHandler:this.onToggleViewHandler}),React.createElement(RichTextEditorMarkdown,{content:n.value,onChangeHandler:n.onChange}),React.createElement("div",{className:"is-block"},React.createElement("textarea",_extends({},n,{className:"markdown-editor-input"})))))))}}RichTextInput.defaultProps={className:"richtext-input",required:!1},RichTextInput.propTypes={className:PropTypes.string,label:PropTypes.string.isRequired,name:PropTypes.string.isRequired,required:PropTypes.oneOfType([PropTypes.bool,PropTypes.func,PropTypes.arrayOf(PropTypes.func)])};class SelectInput extends React.PureComponent{constructor(...e){super(...e),_defineProperty(this,"formatSelectedValue",e=>{if(!e)return null;const{format:r}=this.props;return e[r.id]}),_defineProperty(this,"parseSelectedValue",e=>{if("string"!=typeof e)return null;const{format:r,options:t}=this.props;return t.find(t=>t[r.id]===e)}),_defineProperty(this,"renderOption",(e,r)=>(t,a)=>{const o=napperCore.uniqKeyId(r,"select",a);return React.createElement("option",{key:o,value:t[e.id]},t[e.label])}),_defineProperty(this,"renderDefaultOption",()=>{const{name:e,placeholder:r}=this.props,t=napperCore.uniqKeyId(e,"select","__default__");return React.createElement("option",{key:t},r)})}render(){const{className:e,disabled:r,format:t,label:a,name:o,options:n,required:s,size:i}=this.props,l=composeValidators(s,[isRequired]);return React.createElement(reactFinalForm.Field,{name:o,validate:l,parse:this.parseSelectedValue,format:this.formatSelectedValue},({input:l,meta:p})=>React.createElement("div",{className:`${e}`},React.createElement("label",{htmlFor:o},React.createElement(FieldLabel,{label:a,disabled:r,required:s}),React.createElement("select",_extends({},l,{size:i,multiple:!1,disabled:r}),this.renderDefaultOption(),n&&n.map(this.renderOption(t,o))),React.createElement(FieldError,p))))}}SelectInput.defaultProps={className:"m12",disabled:!1,format:{id:"id",label:"label"},placeholder:"Select a value",required:!1,size:1},SelectInput.propTypes={className:PropTypes.string,disabled:PropTypes.bool,format:PropTypes.shape({label:PropTypes.string,value:PropTypes.string}),label:PropTypes.string.isRequired,name:PropTypes.string.isRequired,options:PropTypes.arrayOf(PropTypes.object).isRequired,placeholder:PropTypes.string,required:PropTypes.oneOfType([PropTypes.bool,PropTypes.func,PropTypes.arrayOf(PropTypes.func)]),size:PropTypes.number};const DEFAULT_VALIDATORS$1=[isNotEmptyString];class TextareaInput extends React.PureComponent{render(){const{className:e,disabled:r,label:t,maxlength:a,name:o,placeholder:n,readonly:s,required:i}=this.props,l=composeValidators(i,DEFAULT_VALIDATORS$1);return React.createElement(reactFinalForm.Field,{name:o,validate:l},({input:l,meta:p})=>React.createElement("div",{className:e},React.createElement("label",{htmlFor:o},React.createElement(FieldLabel,{disabled:r,label:t,required:i}),React.createElement("textarea",_extends({},l,{wrap:"soft",disabled:r,readOnly:s,maxLength:a,placeholder:n})),React.createElement(FieldError,p))))}}TextareaInput.defaultProps={autoComplete:!1,className:"m12",disabled:!1,label:null,maxlength:1/0,placeholder:"Entrer une valeur",readonly:!1,required:!1},TextareaInput.propTypes={autoComplete:PropTypes.bool,className:PropTypes.string,disabled:PropTypes.bool,label:PropTypes.string,maxlength:PropTypes.number,name:PropTypes.string.isRequired,placeholder:PropTypes.string,readonly:PropTypes.bool,required:PropTypes.oneOfType([PropTypes.bool,PropTypes.func,PropTypes.arrayOf(PropTypes.func)])};const DEFAULT_VALIDATORS$2=[isNotEmptyString];class TextInput extends React.PureComponent{render(){const{className:e,disabled:r,label:t,name:a,placeholder:o,required:n}=this.props,s=composeValidators(n,DEFAULT_VALIDATORS$2);return React.createElement(reactFinalForm.Field,{name:a,validate:s},({input:s,meta:i})=>React.createElement("div",{className:e},React.createElement("label",{htmlFor:a},React.createElement(FieldLabel,{disabled:r,label:t,required:n}),React.createElement("input",_extends({},s,{type:"text",id:a,disabled:r,placeholder:o})),React.createElement(FieldError,i))))}}TextInput.defaultProps={autoComplete:!1,className:"m12",disabled:!1,label:null,placeholder:"Entrer une valeur",required:!1},TextInput.propTypes={autoComplete:PropTypes.bool,className:PropTypes.string,disabled:PropTypes.bool,label:PropTypes.string,name:PropTypes.string.isRequired,placeholder:PropTypes.string,required:PropTypes.oneOfType([PropTypes.bool,PropTypes.func,PropTypes.arrayOf(PropTypes.func)])};class SmarterForm extends React.PureComponent{render(){const{children:e,controls:r,initialValues:t,name:a,onSubmit:o,validators:n}=this.props,s=[onErrorFocusDecorator()],i=composeFormValidator(n);return React.createElement(reactFinalForm.Form,{name:a,onSubmit:o,validate:i,decorators:s,initialValues:t,render:({dirty:t,form:a,handleSubmit:o,invalid:n,pristine:s,submitError:i,submitting:l,values:p})=>{const d=l,c=!(s||n);return console.log("Form values => ",p),React.createElement("form",{onSubmit:o},React.createElement("div",null,e),i&&React.createElement("div",{className:"error"},i),r&&React.createElement(FormControls,{canReset:t,disabled:d,onReset:a.reset,canSubmit:c}))}})}}SmarterForm.defaultProps={controls:!0,initialValues:{},validators:[()=>void 0]},SmarterForm.propTypes={children:PropTypes.node.isRequired,controls:PropTypes.bool,initialValues:PropTypes.shape(),name:PropTypes.string.isRequired,onSubmit:PropTypes.func.isRequired,validators:PropTypes.arrayOf(PropTypes.func)},exports.BooleanInput=BooleanInput,exports.FieldError=FieldError,exports.FieldLabel=FieldLabel,exports.FormControls=FormControls,exports.MarkdownInput=RichTextInput,exports.NumberInput=NumberInput,exports.SelectInput=SelectInput,exports.SmarterForm=SmarterForm,exports.TextAreaInput=TextareaInput,exports.TextInput=TextInput,exports.composeFieldValidators=composeValidators,exports.composeFormValidator=composeFormValidator,exports.includesRange=includesRange,exports.isNotEmptyString=isNotEmptyString,exports.isNumber=isNumber,exports.isRequired=isRequired;
